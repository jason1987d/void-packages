# Template file for 'bitmagnet'
pkgname=bitmagnet
version=0.10.0
revision=1
build_style=go
go_import_path="github.com/bitmagnet-io/bitmagnet"
go_package="${go_import_path}"
go_build_tags="v0.10.0"
go_ldflags="-compressdwarf=false -linkmode=external -X github.com/bitmagnet-io/bitmagnet/internal/version.GitTag=v${version}"
hostmakedepends="git"
depends="go glibc postgresql redis"
short_desc="BitTorrent indexer, DHT crawler, and torrent search engine"
maintainer="Jason Elswick <jason@jasondavid.us>"
license="MIT"
homepage="https://bitmagnet.io"
distfiles="https://github.com/bitmagnet-io/bitmagnet/archive/refs/tags/v${version}.tar.gz"
checksum=9a5783f1560442be76f7cd81a8b4a053a8864c17d6e57a8b0890ed784a1c18b8
system_accounts="_bitmagnet"
_bitmagnet_homedir="/var/lib/bitmagnet"
make_dirs="
	/etc/bitmagnet 0755 _bitmagnet _bitmagnet
	/var/lib/bitmagnet 0755 _bitmagnet _bitmagnet
	/var/log/bitmagnet 0755 _bitmagnet _bitmagnet
"
make_check=no # appears tests are not provided

export GOFLAGS="-buildmode=pie -trimpath -mod=readonly -modcacherw"

pre_build() {
	go mod download
}

post_install() {
	vsv bitmagnet
	vlicense LICENSE
}
