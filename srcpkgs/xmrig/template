# Template file for 'xmrig'
pkgname=xmrig
version=6.24.0
revision=1
build_style=cmake
makedepends="libuv-devel openssl-devel libhwloc-devel"
short_desc="RandomX, KawPow, CryptoNight, GhostRider unified CPU/GPU miner"
maintainer="Jason Elswick <jason@jasondavid.us>"
license="GPL-3.0-or-later"
homepage="https://github.com/xmrig/xmrig"
distfiles="https://github.com/xmrig/xmrig/archive/refs/tags/v${version}.tar.gz"
checksum=3521c592a18ada781d79c919ea6c1b7e5a8bcfe2ec666789bc55fd88a2aee8d3
make_check=no # no tests from upstream provided

post_extract() {
	sed -i 's/constexpr const int kDefaultDonateLevel = 1;/constexpr const int kDefaultDonateLevel = 0;/g' ${wrksrc}/src/donate.h
	sed -i 's/constexpr const int kMinimumDonateLevel = 1;/constexpr const int kMinimumDonateLevel = 0;/g' ${wrksrc}/src/donate.h
}

do_install() {
	vbin build/xmrig
	vmkdir usr/share/doc/xmrig
	vcopy doc/* usr/share/doc/xmrig
	vmkdir usr/share/examples/xmrig
	vcopy src/config.json usr/share/examples/xmrig
}
